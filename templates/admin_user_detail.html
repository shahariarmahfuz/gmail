{% extends "base.html" %}
{% block content %}
  <h1>Admin: User Detail</h1>
  <div class="card">
    <p class="muted">Logged in as: <b>{{ admin.username }}</b> | <a href="/admin">Dashboard</a> | <a href="/admin/users">User List</a> | <a href="/admin/logout">Logout</a></p>

    {% if error %}<p style="color:red; margin-top:10px;">{{ error }}</p>{% endif %}
    {% if success %}<p style="color:green; margin-top:10px;">{{ success }}</p>{% endif %}

    <h3 style="margin-top:16px;">প্রোফাইল</h3>
    <div style="border:1px solid #e2e8f0; padding:12px; border-radius:0;">
      <b>User:</b> {{ profile.username }} ({{ profile.user_id }})<br>
      <b>Banned:</b> {{ "Yes" if profile.is_banned else "No" }}<br>
      <b>Created:</b> {{ profile.created_at }}<br>
      <b>Gmail:</b> {{ profile.gmail or "N/A" }}<br>
      <b>Recovery:</b> {{ profile.recovery_email or "N/A" }}<br>
      <b>Secret:</b> {{ profile.secret or "N/A" }}<br>
      <b>Draft Created:</b> {{ profile.draft_created_at or "" }}<br>
      <b>Draft Updated:</b> {{ profile.draft_updated_at or "" }}
    </div>

    <div style="margin-top:10px;">
      {% if profile.is_banned %}
      <form method="post" action="/admin/users/ban">
        <input type="hidden" name="user_id" value="{{ profile.user_id }}">
        <input type="hidden" name="action" value="unban">
        <button class="submit-btn" type="submit">Unban</button>
      </form>
      {% else %}
      <form method="post" action="/admin/users/ban">
        <input type="hidden" name="user_id" value="{{ profile.user_id }}">
        <input type="hidden" name="action" value="ban">
        <button class="submit-btn" type="submit">Ban</button>
      </form>
      {% endif %}
    </div>
  </div>

  <div class="card">
    <h3>উইথড্র রিকুয়েস্ট</h3>
    <table border="1" cellpadding="6" cellspacing="0" style="width:100%; margin-top:8px;">
      <tr>
        <th>ID</th>
        <th>Amount</th>
        <th>Status</th>
        <th>Method</th>
        <th>Number</th>
        <th>TXID</th>
        <th>Note</th>
        <th>Created</th>
      </tr>
      {% for w in withdrawals %}
      <tr>
        <td>{{ w.withdrawal_id }}</td>
        <td>{{ w.amount }}</td>
        <td>{{ w.status }}</td>
        <td>{{ w.method }}</td>
        <td>{{ w.number }}</td>
        <td>{{ w.admin_txid or "" }}</td>
        <td>{{ w.admin_note or "" }}</td>
        <td>{{ w.created_at }}</td>
      </tr>
      {% else %}
      <tr>
        <td colspan="8">No withdrawals found.</td>
      </tr>
      {% endfor %}
    </table>
  </div>

  <div class="card">
    <h3>টাস্ক ডিটেইলস</h3>
    <table border="1" cellpadding="6" cellspacing="0" style="width:100%; margin-top:8px;">
      <tr>
        <th>Job ID</th>
        <th>Task ID</th>
        <th>Status Raw</th>
        <th>Status Norm</th>
        <th>Final</th>
        <th>Last Sync</th>
        <th>Created</th>
      </tr>
      {% for t in tasks %}
      <tr>
        <td>{{ t.job_id }}</td>
        <td>{{ t.job_task_id }}</td>
        <td>{{ t.status_raw or "" }}</td>
        <td>{{ t.status_norm or "" }}</td>
        <td>{{ "Yes" if t.is_final else "No" }}</td>
        <td>{{ t.last_sync_at or "" }}</td>
        <td>{{ t.created_at }}</td>
      </tr>
      {% else %}
      <tr>
        <td colspan="7">No tasks found.</td>
      </tr>
      {% endfor %}
    </table>
  </div>
{% endblock %}
