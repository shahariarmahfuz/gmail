<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gmail Submit - xneko</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    /* --- CSS Variables & Reset --- */
    :root{
      --bg-body: #ffffff; 
      --card-bg: #ffffff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border: #e5e7eb;
      --shadow: 0 18px 40px rgba(0,0,0,0.12);
      --btn: #111827;
      --btn-hover: #0b1220;
      --gradient-btn: linear-gradient(to right, #f59e0b, #ef4444);
      --input-bg: #ffffff;
    }

    * { 
      box-sizing: border-box;
      margin: 0; 
      padding: 0; 
    }

    body {
      font-family: 'Raleway', sans-serif;
      background-color: var(--bg-body);
      color: var(--text-main);
      min-height: 100vh;
      position: relative;
    }

    /* --- GRID BACKGROUND --- */
    .grid-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: -1;
      pointer-events: none;
      background-color: #ffffff;
      overflow: hidden;
    }

    .grid-background {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      background-image: 
          linear-gradient(to right, rgba(0, 0, 0, 0.04) 1px, transparent 1px),
          linear-gradient(to bottom, rgba(0, 0, 0, 0.04) 1px, transparent 1px);
      background-size: 20px 20px;
      -webkit-mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
      mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
    }

    /* --- TOP NAVBAR --- */
    .top-nav {
      position: fixed; top: 0; left: 0; width: 100%; height: 60px; 
      display: flex; justify-content: space-between; align-items: center; 
      padding: 0 20px; 
      background: rgba(255,255,255,0.85); backdrop-filter: blur(12px); 
      border-bottom: 1px solid rgba(0,0,0,0.08); z-index: 100;
    }

    .nav-brand {
      font-size: 18px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
    }

    .fb-btn {
      display: flex; align-items: center; text-decoration: none; 
      color: var(--text-main); padding: 5px 12px; 
      background: rgba(0,0,0,0.05); border-radius: 30px; 
      transition: background 0.2s; max-width: 100%; 
    }
    .fb-btn:hover { background: rgba(0,0,0,0.1); }

    .fb-icon-svg {
      width: 20px; height: 20px; color: #1877F2; margin-right: 8px; flex-shrink: 0;
    }

    .fb-name {
      font-size: 14px; font-weight: 600; white-space: nowrap; 
      overflow: hidden; text-overflow: ellipsis;
    }

    @media (max-width: 380px) {
      .top-nav { padding: 0 10px; }
      .nav-brand { font-size: 16px; }
      .fb-btn { padding: 4px 10px; max-width: 150px; }
      .fb-name { font-size: 12px; }
      .fb-icon-svg { width: 16px; height: 16px; margin-right: 5px; }
    }

    /* --- MAIN CONTENT --- */
    .main-content {
      padding-top: 90px; 
      padding-bottom: 100px; 
      padding-left: 20px; 
      padding-right: 20px;
      max-width: 900px;
      margin: 0 auto;
    }

    .page-title {
      font-size: 2.5rem; 
      font-weight: 800; 
      margin-bottom: 25px; 
      color: var(--text-main);
      text-align: center;
    }

    /* Card Styles */
    .dashboard-card {
      width: 100%;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      box-shadow: var(--shadow);
      padding: 24px;
      margin-bottom: 20px;
    }

    .dashboard-card h3 {
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 18px;
      font-weight: 700;
      color: var(--text-main);
      border-bottom: 1px solid #f3f4f6;
      padding-bottom: 10px;
    }

    /* Form Elements */
    .styled-input {
      width: 100%;
      height: 48px;
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0 16px;
      font-size: 15px;
      font-weight: 500;
      background: var(--input-bg);
      font-family: 'Raleway', sans-serif;
      outline: none;
      transition: all .15s ease;
      margin-bottom: 15px;
    }

    /* ✅ NEW BEAUTIFUL FILE UPLOAD CSS */
    .file-upload-wrapper {
      position: relative;
      width: 100%;
      height: 140px;
      border: 2px dashed #cbd5e1;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #f8fafc;
      transition: all 0.2s ease;
      cursor: pointer;
      margin-bottom: 15px;
      overflow: hidden;
    }
    
    .file-upload-wrapper:hover {
      border-color: #f59e0b;
      background: #fff7ed;
    }

    .file-upload-input {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      opacity: 0;
      cursor: pointer;
      z-index: 10;
    }

    .upload-icon-display {
      width: 40px;
      height: 40px;
      color: #94a3b8;
      margin-bottom: 8px;
      transition: color 0.2s;
    }
    
    .file-upload-wrapper:hover .upload-icon-display {
      color: #f59e0b;
    }

    .upload-text {
      font-size: 14px;
      font-weight: 600;
      color: #64748b;
    }
    
    .file-name-display {
      margin-top: 5px;
      font-size: 13px;
      color: #16a34a; /* Green for success */
      font-weight: 700;
      text-align: center;
      padding: 0 10px;
    }

    .primary-btn {
      width: 100%;
      height: 48px;
      border: none;
      border-radius: 4px;
      background: var(--gradient-btn);
      color: white;
      font-size: 15px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: transform .06s ease, opacity .15s ease;
      font-family: 'Raleway', sans-serif;
    }
    .primary-btn:hover { opacity: 0.9; }
    .primary-btn:active { transform: translateY(1px); }

    /* Lists and Copy Button Styling */
    .info-list {
      margin-top: 10px;
      padding: 0;
      list-style: none;
      color: var(--text-muted);
    }
    .info-list li {
      margin-bottom: 12px;
      font-size: 14px;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: space-between; 
      background: #f9fafb;
      padding: 10px 12px;
      border-radius: 6px;
      border: 1px solid #f3f4f6;
    }
    .info-label { display: block; margin-bottom: 2px; font-size: 12px; color:#9ca3af; }
    .info-value { color: var(--text-main); font-weight: 700; font-size: 15px; word-break: break-all; }

    .copy-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: #64748b;
      padding: 6px;
      border-radius: 4px;
      transition: background 0.2s, color 0.2s;
      display: flex;
      align-items: center;
    }
    .copy-btn:hover { background: #e2e8f0; color: #0f172a; }
    .copy-btn svg { width: 18px; height: 18px; }

    .totp-container {
      display: flex;
      align-items: center;
      gap: 15px;
      margin: 10px 0;
    }
    .totp-display {
      font-size: 32px;
      font-weight: 800;
      color: #0f172a;
      letter-spacing: 3px;
    }

    /* --- BOTTOM NAVBAR --- */
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; width: 100%; height: 70px;
      background: rgba(255,255,255,0.85); backdrop-filter: blur(10px);
      border-top: 1px solid rgba(0,0,0,0.1);
      display: flex; justify-content: space-around; align-items: center;
      padding: 0 10px; z-index: 100;
    }

    .nav-item {
      display: flex; flex-direction: column; align-items: center;
      text-decoration: none; color: #64748b; width: 25%;
    }
    .nav-item.active { color: var(--text-main); }
    .nav-icon-svg { width: 24px; height: 24px; margin-bottom: 4px; }
    .nav-text { font-size: 11px; font-weight: 600; } 

    .text-muted { color: var(--text-muted); font-size: 14px; margin-bottom: 10px; display: block; }
    .logout-link { color: #ef4444; font-weight: 700; text-decoration: none; margin-left: 5px; }

  </style>
</head>

<body>

  <div class="grid-wrapper">
      <div class="grid-background"></div>
  </div>

  <div class="top-nav">
    <div class="nav-brand">xneko</div>
    <a href="https://www.facebook.com/theeliteman" target="_blank" class="fb-btn">
      <svg class="fb-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
      </svg>
      <span class="fb-name">Mahfuz Ahmed</span>
    </a>
  </div>

  <main class="main-content">
    <h1 class="page-title">Gmail Submit</h1>
    
    <div class="dashboard-card">
      <p style="margin:0; font-size:15px; color:#6b7280;">
        Logged in as: <b>{{ user.username }}</b> | <a href="/logout" class="logout-link">Logout</a>
      </p>
      {% if error %}
        <p style="color:#ef4444; margin-top:10px; background:#fef2f2; padding:10px; border-radius:4px; font-weight:600;">
          {{ error }}
        </p>
      {% endif %}
      {% if success %}
        <p style="color:#10b981; margin-top:10px; background:#ecfdf5; padding:10px; border-radius:4px; font-weight:600;">
          {{ success }}
        </p>
      {% endif %}
    </div>

    <div class="dashboard-card">
      <h3>Step 1: Enter Gmail</h3>
      <form method="post" action="/user/gmail/start">
        <input name="gmail" type="email" class="styled-input" placeholder="example@gmail.com" required value="{{ draft.gmail if draft else '' }}">
        <button type="submit" class="primary-btn">Start Now</button>
      </form>
    </div>

    {% if draft and draft.gmail %}
      <div class="dashboard-card">
        <h3>Generated Info</h3>
        
        <ul class="info-list">
          <li>
            <div>
              <span class="info-label">Gmail</span>
              <span class="info-value" id="copy-gmail">{{ draft.gmail }}</span>
            </div>
            <button class="copy-btn" onclick="copyToClipboard('copy-gmail', this)" title="Copy Gmail">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5" /></svg>
            </button>
          </li>
          <li>
            <div>
              <span class="info-label">Password</span>
              <span class="info-value" id="copy-pass">{{ draft.gen_password }}</span>
            </div>
            <button class="copy-btn" onclick="copyToClipboard('copy-pass', this)" title="Copy Password">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5" /></svg>
            </button>
          </li>
          <li>
            <div>
              <span class="info-label">Recovery Email</span>
              <span class="info-value" id="copy-rec">{{ draft.recovery_email }}</span>
            </div>
            <button class="copy-btn" onclick="copyToClipboard('copy-rec', this)" title="Copy Recovery Email">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5" /></svg>
            </button>
          </li>
        </ul>

        <h3 style="margin-top:20px;">Step 2: Upload Authenticator QR</h3>
        <span class="text-muted">টিপস: QR যেন পরিষ্কার দেখা যায়—QR অংশটা zoom করে screenshot দিন।</span>
        
        <form method="post" action="/user/gmail/upload-qr" enctype="multipart/form-data">
          <div class="file-upload-wrapper">
            <input type="file" name="qr_image" accept="image/*" class="file-upload-input" required onchange="showFileName(this)">
            <svg class="upload-icon-display" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" />
            </svg>
            <p class="upload-text">Click to upload QR Screenshot</p>
            <p id="file-name" class="file-name-display"></p>
          </div>
          <button type="submit" class="primary-btn">Extract Secret</button>
        </form>
      </div>
    {% endif %}

    {% if draft and draft.secret %}
      <div class="dashboard-card">
        <h3>Secret Key</h3>
        <div style="background:#f3f4f6; padding:12px; border-radius:6px; margin-bottom:20px; display:flex; justify-content:space-between; align-items:center;">
          <span style="font-family:monospace; font-size:14px; word-break:break-all; font-weight:600;" id="copy-secret">{{ draft.secret }}</span>
          <button class="copy-btn" onclick="copyToClipboard('copy-secret', this)" title="Copy Secret">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5" /></svg>
          </button>
        </div>

        <h3>Live Authenticator Code</h3>
        <div class="totp-container">
          <div class="totp-display" id="totp_code">------</div>
          <button class="copy-btn" onclick="copyToClipboard('totp_code', this)" title="Copy Code">
             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5" /></svg>
          </button>
        </div>
        <div style="color:#6b7280; font-size:13px;" id="totp_meta">Loading...</div>

        <script>
          async function refreshTotp() {
            try {
              const r = await fetch("/user/gmail/totp", {cache: "no-store"});
              const j = await r.json();
              if (!j.ok) {
                document.getElementById("totp_code").innerText = "------";
                document.getElementById("totp_meta").innerText = j.error || "No secret";
                return;
              }
              document.getElementById("totp_code").innerText = j.code;
              document.getElementById("totp_meta").innerText = `Refresh in ${j.remaining}s (period ${j.period}s)`;
            } catch (e) {
              document.getElementById("totp_meta").innerText = "Error fetching code";
            }
          }
          refreshTotp();
          setInterval(refreshTotp, 1000);
        </script>

        <h3 style="margin-top:20px;">Step 3: Submit Job Proof</h3>
        <form method="post" action="/user/gmail/submit">
          <button type="submit" class="primary-btn">Submit Now</button>
        </form>
      </div>
    {% endif %}

    <div class="dashboard-card">
      <form method="post" action="/user/gmail/reset">
        <button type="submit" class="primary-btn" style="background:#374151;">Reset Draft</button>
      </form>
    </div>
  </main>

  <nav class="bottom-nav">
    <a href="/" class="nav-item">
      <svg class="nav-icon-svg" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" /></svg>
      <span class="nav-text">Home</span>
    </a>
    <a href="/user/gmail" class="nav-item active">
      <svg class="nav-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#4caf50" d="M45,16.2l-5,2.75l-5,4.75L35,40h7c1.657,0,3-1.343,3-3V16.2z"></path><path fill="#1e88e5" d="M3,16.2l3.614,1.71L13,23.7V40H6c-1.657,0-3-1.343-3-3V16.2z"></path><polygon fill="#e53935" points="35,11.2 24,19.45 13,11.2 12,17 13,23.7 24,31.95 35,23.7 36,17"></polygon><path fill="#c62828" d="M3,12.298V16.2l10,7.5V11.2L9.876,8.859C9.132,8.301,8.228,8,7.298,8h0C4.924,8,3,9.924,3,12.298z"></path><path fill="#fbc02d" d="M45,12.298V16.2l-10,7.5V11.2l3.124-2.341C38.868,8.301,39.772,8,40.702,8h0 C43.076,8,45,9.924,45,12.298z"></path></svg>
      <span class="nav-text">Submit</span>
    </a>
    <a href="/user/tasks" class="nav-item">
      <svg class="nav-icon-svg" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 1.414 1.146 2.56 2.56 2.56 1.415 0 2.56-1.146 2.56-2.56a2.573 2.573 0 00-.1-.664m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
      </svg>
      <span class="nav-text">Tasks</span>
    </a>
    <a href="/user/withdraw" class="nav-item">
      <svg class="nav-icon-svg" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a2.25 2.25 0 00-2.25-2.25H15a3 3 0 11-6 0H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 9m18 0V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v3" /></svg>
      <span class="nav-text">Withdraw</span>
    </a>
  </nav>

  <script>
    // Copy to Clipboard
    function copyToClipboard(elementId, btnElement) {
      const textToCopy = document.getElementById(elementId).innerText;
      navigator.clipboard.writeText(textToCopy).then(() => {
        const originalIcon = btnElement.innerHTML;
        btnElement.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="#10b981">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
          </svg>
        `;
        setTimeout(() => {
          btnElement.innerHTML = originalIcon;
        }, 1500);
      });
    }

    // Show Selected File Name
    function showFileName(input) {
      const display = document.getElementById('file-name');
      if (input.files && input.files[0]) {
        display.innerText = "Selected: " + input.files[0].name;
      }
    }
  </script>

</body>
</html>
