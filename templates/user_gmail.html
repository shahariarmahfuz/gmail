<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gmail Submit</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body style="margin:0; padding:0; box-sizing:border-box; font-family:'Raleway', sans-serif; background:#ffffff; color:#1e293b; min-height:100vh;">
  <div style="position:fixed; top:0; left:0; width:100%; height:60px; display:flex; justify-content:space-between; align-items:center; padding:0 30px; background:rgba(255,255,255,0.9); backdrop-filter:blur(12px); border-bottom:1px solid rgba(0,0,0,0.08); box-shadow:0 4px 6px -1px rgba(0,0,0,0.03); z-index:100;">
    <div style="font-size:18px; font-weight:700; color:#0f172a; text-transform:uppercase; letter-spacing:1px;">Earning</div>
    <a href="https://www.facebook.com/YOUR_LINK_HERE" target="_blank" style="display:flex; align-items:center; text-decoration:none; color:#0f172a; padding:6px 14px; background:rgba(0,0,0,0.04); border-radius:30px;">
      <svg style="width:20px; height:20px; color:#1877F2; margin-right:10px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
      </svg>
      <span style="font-size:14px; font-weight:700; white-space:nowrap;">Mahfuz Ahmed</span>
    </a>
  </div>

  <main style="padding-top:110px; max-width:900px; margin:0 auto; padding-left:20px; padding-right:20px; padding-bottom:100px;">
    <h1 style="font-size:2.5rem; font-weight:800; margin-bottom:20px; color:#0f172a;">Gmail Submit</h1>
    <div style="width:100%; background:#fff; border:1px solid #e2e8f0; padding:20px; margin-bottom:16px;">
      <p style="color:#64748b; margin:0;">Logged in as: <b>{{ user.username }}</b> | <a href="/logout">Logout</a></p>
      {% if error %}<p style="color:red; margin-top:10px;"><b>{{ error }}</b></p>{% endif %}
      {% if success %}<p style="color:green; margin-top:10px;"><b>{{ success }}</b></p>{% endif %}
    </div>

    <div style="width:100%; background:#fff; border:1px solid #e2e8f0; padding:20px; margin-bottom:16px;">
      <h3>Step 1: Enter Gmail</h3>
      <form method="post" action="/user/gmail/start">
        <input name="gmail" type="email" placeholder="example@gmail.com" required value="{{ draft.gmail if draft else '' }}" style="width:100%; padding:16px 20px; font-size:16px; border:1px solid #cbd5e1; margin-bottom:12px;">
        <button type="submit" style="padding:16px 32px; font-size:16px; font-weight:700; text-transform:uppercase; letter-spacing:1px; color:#fff; background:linear-gradient(to right, #f59e0b, #ef4444); border:none;">Start Now</button>
      </form>
    </div>

    {% if draft and draft.gmail %}
      <div style="width:100%; background:#fff; border:1px solid #e2e8f0; padding:20px; margin-bottom:16px;">
        <h3>Generated Info</h3>
        <ul style="margin-top:10px; padding-left:18px;">
          <li>Gmail: <b>{{ draft.gmail }}</b></li>
          <li>Password: <b>{{ draft.gen_password }}</b></li>
          <li>Recovery Email: <b>{{ draft.recovery_email }}</b></li>
        </ul>

        <h3 style="margin-top:16px;">Step 2: Upload Authenticator QR Screenshot</h3>
        <p style="color:#64748b;">টিপস: QR যেন পরিষ্কার দেখা যায়—QR অংশটা zoom করে screenshot দিন।</p>
        <form method="post" action="/user/gmail/upload-qr" enctype="multipart/form-data">
          <input type="file" name="qr_image" accept="image/*" required style="width:100%; padding:16px 20px; font-size:16px; border:1px solid #cbd5e1; margin-bottom:12px;">
          <button type="submit" style="padding:16px 32px; font-size:16px; font-weight:700; text-transform:uppercase; letter-spacing:1px; color:#fff; background:linear-gradient(to right, #f59e0b, #ef4444); border:none;">Extract Secret</button>
        </form>
      </div>
    {% endif %}

    {% if draft and draft.secret %}
      <div style="width:100%; background:#fff; border:1px solid #e2e8f0; padding:20px; margin-bottom:16px;">
        <h3>Secret Key</h3>
        <p><b>{{ draft.secret }}</b></p>

        <h3 style="margin-top:16px;">Live Authenticator Code</h3>
        <div style="font-size:40px; font-weight:bold;" id="totp_code">------</div>
        <div style="color:#64748b;" id="totp_meta">Loading...</div>

        <script>
          async function refreshTotp() {
            try {
              const r = await fetch("/user/gmail/totp", {cache: "no-store"});
              const j = await r.json();
              if (!j.ok) {
                document.getElementById("totp_code").innerText = "------";
                document.getElementById("totp_meta").innerText = j.error || "No secret";
                return;
              }
              document.getElementById("totp_code").innerText = j.code;
              document.getElementById("totp_meta").innerText = `Refresh in ${j.remaining}s (period ${j.period}s)`;
            } catch (e) {
              document.getElementById("totp_meta").innerText = "Error fetching code";
            }
          }
          refreshTotp();
          setInterval(refreshTotp, 1000);
        </script>

        <h3 style="margin-top:16px;">Step 3: Submit Job Proof</h3>
        <p style="color:#64748b;">Job proof format: <code>gmail:password:recovery_email:secret</code></p>
        <form method="post" action="/user/gmail/submit">
          <button type="submit" style="padding:16px 32px; font-size:16px; font-weight:700; text-transform:uppercase; letter-spacing:1px; color:#fff; background:linear-gradient(to right, #f59e0b, #ef4444); border:none;">Submit Now</button>
        </form>
      </div>
    {% endif %}

    <div style="width:100%; background:#fff; border:1px solid #e2e8f0; padding:20px;">
      <form method="post" action="/user/gmail/reset">
        <button type="submit" style="padding:16px 32px; font-size:16px; font-weight:700; text-transform:uppercase; letter-spacing:1px; color:#fff; background:linear-gradient(to right, #f59e0b, #ef4444); border:none;">Reset Draft</button>
      </form>
    </div>
  </main>
</body>
</html>
